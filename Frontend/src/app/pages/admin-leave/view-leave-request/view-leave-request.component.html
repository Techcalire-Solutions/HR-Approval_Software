<!DOCTYPE html>
<html lang="en">
<body>
  <div fxLayout="row" fxLayoutAlign="space-between center" class="row">
    <div fxLayout="row" class="col">
      <mat-button-toggle-group #controls="matButtonToggleGroup" appearance="legacy" hideSingleSelectionIndicator="true">
        <!-- <mat-button-toggle value="add" (click)="openCalendar()">
          <mat-icon style="color: green;">event</mat-icon>
          CALENDAR
        </mat-button-toggle> -->
      </mat-button-toggle-group>
    </div>
    <div fxLayout="row" class="col">
      <form class="user-search" [class.show]="controls.value == 'search'">
        <mat-form-field class="user-search-input">
          <input matInput placeholder="Search leave by leave type..." name="search" (keyup)="search($event)">
        </mat-form-field>
      </form>
    </div>
  </div>

  <main class="table" id="customers_table">
    <section class="table__body">
      <table>
        <thead>
          <tr>
            <th>Leave Date</th>
            <th>Leave Type</th>
            <th>User</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Admin Notes</th>
          
          
             <th>Uplaods</th>
             <th>Action</th>
             <th>Manage</th>
          </tr>
        </thead>
        <tbody>
          <!-- Loop through each leave -->
          <tr *ngFor="let item of leaves" [ngClass]="{'highlight': item.fileUrl}"  [routerLink]="['/login/admin-leave/view/', item.id]">
            <!-- Leave Date -->
            <td>
              <ng-container *ngFor="let date of item.leaveDates">
                {{ date.date | date: 'dd-MM-yyyy' }}<br>
                @if(date.session1==true){
                  session 1<br>
                }
                @if(date.session2==true){
                  session 2<br>
                }
              </ng-container>
            </td>

            <!-- Leave Type -->
            <td>{{ item.leaveType.leaveTypeName }}</td>
            <td>{{ item.user.name }}</td>
            <td>{{ item.notes }}</td>
            <td>{{ item.status }}</td>
            <td>{{item.adminNotes}}</td>


          

            <td (click)="$event.stopPropagation()">
              <div class="popup-message">
                @if(item.leaveType?.leaveTypeName === 'Sick Leave'){
                  @if(item.fileUrl){
                    <div>
                      <img 
                          [src]="item.fileUrl" 
                          class="transition-2" 
                          [ngClass]="{ 'enlarged': enlargedItemId === item.id }"
                          [style.width]="enlargedItemId === item.id ? '500px' : '50px'"
                          [style.height]="enlargedItemId === item.id ? '500px' : '50px'"
                          (click)="toggleImageSize(item.id)"
                      />
                  </div>
                  }@else {
                    <button  class="icon-btn upload-btn" mat-icon-button color="primary" (click)="upload('approve', item.id)">
                      <mat-icon>cloud_upload</mat-icon>
                    </button>
                  }
                }
              </div>

            </td>
            <td (click)="$event.stopPropagation()">
              <ng-container *ngIf="item.status !== 'AdminApproved'; else disabledIcon">
                <button
                  mat-raised-button
                  class="approve-button"
                  color="primary"
                  (click)="openDialog('approve', item.id)"
                  [disabled]="item.status === 'Approved'"
                >
                  APPROVE
                </button>
                &nbsp;
                <button
                  mat-raised-button
                  class="reject-button"
                  color="warn"
                  (click)="openDialog('reject', item.id)"
                  [disabled]="item.status === 'Rejected' && item.status !== 'AdminDeleted' && item.status !== 'AdminUpdated'"
                >
                  REJECT
                </button>
                &nbsp;
              </ng-container>
              <ng-template #disabledIcon>
                <mat-icon color="disabled">block</mat-icon>
              </ng-template>
            </td>

            <td (click)="$event.stopPropagation()">
              <ng-container>
                <button mat-icon-button color="primary" class="edit-button" (click)="onEditLeave(item.id)">
              <mat-icon>mode_edit</mat-icon>
                </button>

                <button mat-icon-button color="warn" class="delete-button" (click)="onDeleteLeave(item.id)">
                  <mat-icon>delete</mat-icon>
                </button>

                &nbsp;



              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Paginator -->
      <mat-paginator
        [length]="totalItems"
        [pageSize]="pageSize"
        [pageIndex]="currentPage - 1"
        (page)="onPageChange($event)"
        [pageSizeOptions]="[10, 20, 30, 40, 50, 100]">
      </mat-paginator>
    </section>
  </main>


</body>
</html>
