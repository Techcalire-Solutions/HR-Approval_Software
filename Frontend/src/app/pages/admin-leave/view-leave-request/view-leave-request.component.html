<!DOCTYPE html>
<html lang="en">
<body>
  <div fxLayout="row" fxLayoutAlign="space-between center" class="row">
    <div fxLayout="row" class="col">
      <mat-button-toggle-group #controls="matButtonToggleGroup" appearance="legacy" hideSingleSelectionIndicator="true">
        <!-- <mat-button-toggle value="add" (click)="openCalendar()">
          <mat-icon style="color: green;">event</mat-icon>
          CALENDAR
        </mat-button-toggle> -->
      </mat-button-toggle-group>
    </div>
    <div fxLayout="row" class="col">
      <form class="user-search" [class.show]="controls.value == 'search'">
        <mat-form-field class="user-search-input">
          <input matInput placeholder="Search leave by leave type..." name="search" (keyup)="search($event)">
        </mat-form-field>
      </form>
    </div>
  </div>

  <main class="table" id="customers_table">
    <section class="table__body">
      <table>
        <thead>
          <tr>
            <th>Leave Date</th>
            <th>Leave Type</th>
            <th>User</th>
            <th>Reason</th>
            <th>Status</th>
             <th>Action</th>
             <th>Manage</th>
             <th>Uplaods</th>
          </tr>
        </thead>
        <tbody>
          <!-- Loop through each leave -->
          <tr *ngFor="let item of leaves" [ngClass]="{'highlight': item.fileUrl}"  [routerLink]="['/login/admin-leave/view/', item.id]">
            <!-- Leave Date -->
            <td>
              <ng-container *ngFor="let date of item.leaveDates">
                {{ date.date | date: 'dd-MM-yyyy' }}<br>
                @if(date.session1==true){
                  session 1<br>
                }
                @if(date.session2==true){
                  session 2<br>
                }



              </ng-container>
            </td>

            <!-- Leave Type -->
            <td>{{ item.leaveType.leaveTypeName }}</td>
            <td>{{ item.user.name }}</td>
            <td>{{ item.notes }}</td>


            <td>{{ item.status }}</td>



            <td (click)="$event.stopPropagation()">
              <ng-container>
                <button mat-icon-button color="primary" class="edit-button" (click)="onEditLeave(item.id)">
              <mat-icon>mode_edit</mat-icon>
                </button>

                <button mat-icon-button color="warn" class="delete-button" (click)="onDeleteLeave(item.id)">
                  <mat-icon>delete</mat-icon>
                </button>

                &nbsp;



              </ng-container>
            </td>

            <td (click)="$event.stopPropagation()">

              <ng-container *ngIf="item.status !== 'AdminApproved' && item.status !== 'Rejected' && item.status !== 'Approved' && item.status !== 'AdminDeleted'&& item.status !== 'AdminUpdated'">
                <button mat-raised-button class="approve-button" color="primary" (click)="openDialog('approve', item.id)" [disabled]="item.status === 'Approved'">
                  APPROVE
                </button> &nbsp;
                <button mat-raised-button class="reject-button" color="warn" (click)="openDialog('reject', item.id)" [disabled]="item.status === 'Rejected' && item.status !== 'AdminDeleted' && item.status !== 'AdminUpdated'">
                  REJECT
                </button> &nbsp;

              </ng-container>


              <ng-container *ngIf="item.status === 'Approved'">
                <span>
                  <em>Leave Request Approved</em>
                </span>
              </ng-container>


              <ng-container *ngIf="item.status === 'AdminApproved'">
                <span>
                  <em>Leave Request Admin Approved</em>
                </span>
              </ng-container>


              <ng-container *ngIf="item.status === 'Rejected'">
                <span>
                  <em>Leave Request Rejected</em>
                </span>
              </ng-container>
              <ng-container *ngIf="item.status === 'AdminDeleted'">
                <span>
                  <em>Leave Request Deleted</em>
                </span>
              </ng-container>
              <ng-container *ngIf="item.status === 'AdminUpdated'">
                <span>
                  <em>Leave Request Admin Updated</em>
                </span>
              </ng-container>

                          </td>

            <td (click)="$event.stopPropagation()">
              <!-- <div class="popup-message">
                <mat-icon *ngIf="item.fileUrl">check_circle</mat-icon>

              </div> -->
              <div class="popup-message">
                <mat-icon *ngIf="item.fileUrl" class="green-icon">check_circle</mat-icon>
              </div>

            </td>

          </tr>
        </tbody>
      </table>

      <!-- Paginator -->
      <mat-paginator
        [length]="totalItems"
        [pageSize]="pageSize"
        [pageIndex]="currentPage - 1"
        (page)="onPageChange($event)"
        [pageSizeOptions]="[10, 20, 30, 40, 50, 100]">
      </mat-paginator>
    </section>
  </main>


</body>
</html>
