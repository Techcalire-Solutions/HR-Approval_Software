<!DOCTYPE html>
<html lang="en">
<body>
  <div fxLayout="row" fxLayoutAlign="space-between center" class="row">
    <div fxLayout="row" class="col">
      <mat-button-toggle-group #controls="matButtonToggleGroup" appearance="legacy" hideSingleSelectionIndicator="true">
        <mat-button-toggle value="add" (click)="openCalendar()">
          <mat-icon style="color: green;">edit_calendar</mat-icon>
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>
    <div fxLayout="row" class="col">
      <form class="user-search" [class.show]="controls.value == 'search'">
        <mat-form-field class="user-search-input">
          <input matInput placeholder="Search leave by leave type..." name="search" (keyup)="search($event)">
        </mat-form-field>
      </form>
    </div>

    <div fxLayout="row" class="legend col">
      <div fxLayout="row" fxLayoutAlign="space-between center" class="row">
        <div style="display: flex; align-items: center; margin-right: 20px;">
          <span style="color: green; font-weight: bold; font-size:xx-large;">●</span>
          <span style="margin-left: 5px;">Approved</span>
        </div>
        <div style="display: flex; align-items: center; margin-right: 20px;">
          <span style="color: red; font-weight: bold; font-size:xx-large;">●</span>
          <span style="margin-left: 5px;">Rejected</span>
        </div>
        <div style="display: flex; align-items: center; margin-right: 20px;">
          <span style="color: black; font-weight: bold; font-size:xx-large;">●</span>
          <span style="margin-left: 5px;">No Action</span>
        </div>
      </div>
    </div>
    <div fxLayout="row" fxLayoutAlign="space-between center">
      <mat-button-toggle-group #controls="matButtonToggleGroup" appearance="legacy" hideSingleSelectionIndicator="true">
        <mat-button-toggle value="add" (click)="openLeaveCalendar()">
          <mat-icon style="color: green;">event_available</mat-icon>
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>
  </div>

  <main class="table" id="customers_table">
    <section class="table__body">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Leave Date</th>
            <th>Leave Type</th>
            @if(!employeeStat){
              <th>User</th>
            }
            <th>Reason</th>
            <th>Uplaods</th>
            @if(!employeeStat){
              <th>Action</th>
            }
            <th>Manage</th>
          </tr>
        </thead>
        <tbody>
          @for (item of filteredLeaves; track $index) {
            <tr [ngClass]="{'text-green': item.status === 'Approved' || item.status === 'AdminApproved', 'text-red': item.status === 'Rejected'}"
              [routerLink]="['/login/leave/open/', item.id]">
              <td> {{item.id}} </td>
              <td>
                <ng-container *ngFor="let date of item.leaveDates">
                  {{ date.date | date: 'dd-MM-yyyy' }}<br>
                  @if(date.session1==true){
                    session 1<br>
                  }
                  @if(date.session2==true){
                    session 2<br>
                  }
                </ng-container>
              </td>

              <td>{{ item.leaveType.leaveTypeName }}</td>
              @if(!employeeStat){
                <td>{{ item.user?.name }} {{item.user?.empNo}}</td>
              }
              <td>{{ item.notes }}</td>
              <td (click)="$event.stopPropagation()">
                <div class="popup-message">
                  @if(item.leaveType?.leaveTypeName === 'Sick Leave'){
                    @if(item.fileUrl){
                      <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="center center" style="position: relative;">
                        <iframe [src]="item.fileUrl | safe" class="custom-iframe" scrolling="no"></iframe>


                        <!--
                          class="transition-2"
                          [ngClass]="{ 'enlarged': enlargedItemId === item.id }"
                          [style.width]="enlargedItemId === item.id ? '500px' : '400px'"
                          [style.height]="enlargedItemId === item.id ? '500px' : '50px'"> -->
                        <!-- <div
                          (click)="toggleImageSize(item.id)"
                          style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; cursor: pointer;">
                        </div> -->
                      </div>
                    }@else {
                      <button  class="icon-btn upload-btn" mat-icon-button color="primary" (click)="upload('approve', item.id)">
                        <mat-icon>cloud_upload</mat-icon>
                      </button>
                    }
                  }
                </div>

              </td>

              @if(!employeeStat){
                <td (click)="$event.stopPropagation()">
                  <ng-container>
                    <button
                    mat-icon-button
                    class="approve-button"
                    color="primary"
                    (click)="openDialog('approve', item.id)"
                    [disabled]="item.status === 'Approved' || item.status === 'AdminApproved'"
                  >
                    <mat-icon>thumb_up</mat-icon>
                  </button>
                  &nbsp;
                  <button
                    mat-icon-button
                    class="reject-button"
                    color="warn"
                    (click)="openDialog('reject', item.id)"
                    [disabled]="item.status === 'Rejected' || item.status === 'AdminApproved'"

                  >
                  <!--  && item.status !== 'AdminDeleted' && item.status !== 'AdminUpdated' -->
                    <mat-icon>thumb_down</mat-icon>
                  </button>

                    &nbsp;
                  </ng-container>
                  <ng-template #disabledIcon>
                    <mat-icon color="disabled">block</mat-icon>
                  </ng-template>
                </td>
              }
              <td (click)="$event.stopPropagation()">
                @if(!employeeStat || (item.status === 'Requested' || item.status === 'Rejected')){
                  <ng-container>
                    <button mat-icon-button color="primary" class="edit-button" (click)="onEditLeave(item.id)">
                  <mat-icon>mode_edit</mat-icon>
                    </button>

                    <button mat-icon-button color="warn" class="delete-button" (click)="onDeleteLeave(item.id)">
                      <mat-icon>delete</mat-icon>
                    </button>
                    &nbsp;
                  </ng-container>

                }
              </td>
            </tr>
          }
        </tbody>
      </table>

      <!-- Paginator -->
      <mat-paginator
        [length]="totalItems"
        [pageSize]="pageSize"
        [pageIndex]="currentPage - 1"
        (page)="onPageChange($event)"
        [pageSizeOptions]="[10, 20, 30, 40, 50, 100]">
      </mat-paginator>
    </section>
  </main>


</body>
</html>
@if(isLoading) {
  <div fxLayout="column" fxLayoutAlign="center center" class="user-spinner">
      <mat-spinner color="primary"></mat-spinner>
  </div>
}