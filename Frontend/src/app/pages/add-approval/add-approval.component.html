

<mat-card>
  <mat-toolbar class="table-header">
    <div class="row" style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
      <div class="col">
        <h1>UPLOAD</h1>
      </div>
      <div class="col" style="margin-left: auto; margin-right: 5px;" onClick="history.back()">
        <span class="material-icons">exit_to_app</span>
      </div>
    </div>
  </mat-toolbar>

  <mat-card-content>
    <div class="wrapper">
      <form [formGroup]="piForm">
        <mat-form-field appearance="outline">
          <mat-label>InvoiceNo</mat-label>
          <input matInput placeholder="" formControlName="piNo" readonly="true">
        </mat-form-field> 
        <mat-form-field appearance="outline">
          <!-- <mat-label>Supplier Name</mat-label>
          <input matInput placeholder="Enter Supplier Name" formControlName="supplierName"> -->

          <mat-select placeholder="Choose Supplier Name" formControlName="supplierId">
            @for(item of supplierCompanies; track $index){
              <mat-option [value]="item.id">
                {{item.companyName}}
              </mat-option>
            }
            
            
                </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline"> 
          <mat-label>Supplier SO#</mat-label>
          <input matInput placeholder="Enter Supplier SO#" formControlName="supplierSoNo">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Our Supplier PO#</mat-label>
          <input matInput placeholder="Enter Supplier PO#" formControlName="supplierPoNo">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Supplier Currency</mat-label>
          <mat-select formControlName="supplierCurrency">
              <mat-option value="Dollar">Dollar</mat-option>
              <mat-option value="AED">AED</mat-option>
          </mat-select>
      </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Supplier Price</mat-label>
          <input matInput placeholder="Enter Supplier Price" formControlName="supplierPrice">
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Purpose</mat-label>
          <mat-select placeholder="Select Purpose" formControlName="purpose">
            <mat-option value="Stock">Stock</mat-option>
            <mat-option value="Customer">Customer</mat-option>
          </mat-select>
        </mat-form-field>
 
        @if(kamb){
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Manager</mat-label>
            <mat-select placeholder="" formControlName="amId">
            @for(item of AMList; track $index){
              <mat-option [value]="item.id">
                {{item.name}}
              </mat-option>
            }
            </mat-select>
          </mat-form-field>
        }

        @if(am){
          <mat-form-field class="full-width" appearance="outline">
            <mat-label>Accountant</mat-label>
            <mat-select placeholder="" formControlName="accountantId">
            @for(item of AccountantList; track $index){
              <mat-option [value]="item.id">
                {{item.name}}
              </mat-option>
            }
            </mat-select>
          </mat-form-field>
        }

@if(piForm.get('purpose')?.value === 'Customer'){
  <ng-container>
    <mat-form-field appearance="outline">
     
        <mat-select placeholder="Choose Customer Name" formControlName="customerId">
          @for(item of customerCompanies; track $index){
            <mat-option [value]="item.id">
              {{item.companyName}}
            </mat-option>
          }
          
          
              </mat-select>
     
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Customer PO#</mat-label>
      <input matInput placeholder="Enter Customer PO#" formControlName="customerPoNo">
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Our Customer SO#</mat-label>
      <input matInput placeholder="Enter Customer SO#" formControlName="customerSoNo">
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-label>Customer Currency</mat-label>
      <mat-select formControlName="customerCurrency">
          <mat-option value="Dollar">Dollar</mat-option>
          <mat-option value="AED">AED</mat-option>
      </mat-select>
  </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>CustomerPO Value</mat-label>
              <input matInput placeholder="Enter PO Value" formControlName="poValue">
            </mat-form-field>
            <!-- @if(editStatus){
          <mat-form-field appearance="outline">
            <mat-label>Status</mat-label>
            <input matInput placeholder="" formControlName="status">
          </mat-form-field>
        } -->
        <!-- @if(editStatus){
          <mat-form-field appearance="outline">
            <mat-label>Remarks</mat-label>
            <input matInput placeholder="" formControlName="remarks" >
          </mat-form-field>
        } -->

</ng-container>

}
@if(sp){
  <mat-form-field class="full-width" appearance="outline">
    <mat-label>Key Account Manager</mat-label>
    <mat-select placeholder="" formControlName="kamId">
    @for(item of kam; track $index){
      <mat-option [value]="item.id">
        {{item.name}}
      </mat-option>
    }
    </mat-select>
  </mat-form-field>
}
<mat-form-field appearance="outline">
  <mat-label>Notes</mat-label>
  <input matInput placeholder="" formControlName="notes" >
</mat-form-field>       <!-- Conditional Fields -->

</form>
      <form #form class="form">
      

        @if(!imageUrl){
          <div class="col">
            <input type="file" class="file-input" hidden #fileInput (change)="uploadFile($event)">
            <span class="material-icons file-upload-icon" (click)="fileInput.click()">cloud_upload</span>
            <p class="file-upload-text" (click)="fileInput.click()">Browse file to upload</p>
          </div>
      }
      @else{
      <div class="col">
          <div fxLayout="row" fxLayoutGap="16px" fxLayoutAlign="center center">
          @if(fileType === 'pdf'){
              <iframe [src]="imageUrl | safe" width="100%" height="300px"></iframe>
          }@else {
              <img [src]="imageUrl" alt="Image" title="Image" height="300px" class="clickable-image" />
          }

          <mat-icon style="color: red;" (click)="onDeleteImage()">delete</mat-icon>
          </div>
      </div>
      } 
      </form>


@if(file){
  <section class="progress-area" style="width:90%">
    <li class="row">
      <!-- <span class="material-icons">file_copy</span> -->
      <div class="content" >
        <div class="details">
          <span class="name">{{ file.name }} - {{ uploadComplete ? 'Uploaded' : 'Uploading' }}</span>
          @if(!uploadComplete){
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
          }
         
        </div>
      </form>

      <br>
      
      <button mat-raised-button type="button" color="primary" class="btn btn-success" 
        (click)="onSubmit()"  [disabled]="!piForm.valid || !isImageUploaded()"> SAVE
      </button>
    </div>
  </mat-card-content>
</mat-card>

